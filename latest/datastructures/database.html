<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="MPI Architecture" href="../mpi_architecture.html" /><link rel="prev" title="Dictionary" href="dictionary.html" />
        <link rel="canonical" href="https://exasim-project.com/NeoFOAM/datastructures/database.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.08.06 -->
        <title>Database - NeoFOAM documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=6a4ff913" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">NeoFOAM  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">NeoFOAM  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome to NeoFOAM!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basics/index.html">Basics</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Basics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/executor.html">Executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/fields.html">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/segmentedField.html">SegmentedField</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basics/algorithms.html">Parallel Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Parallel Algorithms</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basics/freeFunctions/fill.html"><code class="docutils literal notranslate"><span class="pre">fill</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/freeFunctions/map.html"><code class="docutils literal notranslate"><span class="pre">map</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../basics/freeFunctions/setField.html"><code class="docutils literal notranslate"><span class="pre">setField</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basics/registerclass.html">Derived class discovery at compile time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/macros.html">Macro Definitions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../dsl/index.html">Domain Specific Language (DSL)</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Domain Specific Language (DSL)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../dsl/equation.html">Expression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dsl/operator.html">Operator</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../timeIntegration/index.html">Time Integration</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Time Integration</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../timeIntegration/forwardEuler.html">Forward Euler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timeIntegration/rungeKutta.html">Runge Kutta</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../finiteVolume/cellCentred/index.html">FiniteVolume</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of FiniteVolume</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../finiteVolume/cellCentred/boundaryConditions.html">Boundary Conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../finiteVolume/cellCentred/case_study.html">Case Study: The Gauss Green Div Kernel</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Datastructures</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Datastructures</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="unstructuredMesh.html">UnstructuredMesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="dictionary.html">Dictionary</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Database</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mpi_architecture.html">MPI Architecture</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/datastructures/database.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="database">
<span id="basics-database"></span><h1>Database<a class="headerlink" href="#database" title="Link to this heading">¶</a></h1>
<p>OpenFOAM stores objects in the <code class="docutils literal notranslate"><span class="pre">objectRegistry</span></code> and they can be accessed by their name and type.
In modern software development, best practices emphasize modularity, testability, and loosely coupled components.
While the <code class="docutils literal notranslate"><span class="pre">objectRegistry</span></code> of OpenFOAM offers convenience and simple approach for managing objects, its inherent design conflicts with these principles by:</p>
<ul class="simple">
<li><p>Encouraging reliance on a central container.</p></li>
<li><p>Making the codebase less flexible for testing, refactoring, or adopting new architectural patterns.</p></li>
<li><p>Introducing potential performance bottlenecks and debugging challenges.</p></li>
</ul>
<p>In contrast, NeoFOAM adopts a document-based database approach, where data is stored as a collection of documents.
Each document consists of a pair of strings and values, validated using a custom validator function to ensure data integrity.
The validation ensures that the data stored in the documents adheres to predefined rules and formats, preventing errors and inconsistencies in the database.
The database is not tightly coupled to the <code class="docutils literal notranslate"><span class="pre">fvMesh</span></code> or <code class="docutils literal notranslate"><span class="pre">Time</span></code> classes, making it more flexible and easier to test.</p>
<p>The following class diagram illustrates the relationships between the <code class="docutils literal notranslate"><span class="pre">Database</span></code>, <code class="docutils literal notranslate"><span class="pre">Collection</span></code>, and <code class="docutils literal notranslate"><span class="pre">Document</span></code> components:</p>
<pre  class="mermaid">
        classDiagram

    class Database{
        -std::unordermap&amp;lt;std::string, Collection&gt; data
    }

    class CollectionA{
        +std::vector&amp;lt;std::string&gt; find(std::function predicate)
        -std::unordermap&amp;lt;std::string, Document&gt; data
    }

    class CollectionB{
        +std::vector&amp;lt;std::string&gt; find(std::function predicate)
        -std::unordermap&amp;lt;std::string, Document&gt; data
    }

    class CollectionC[&quot;...&quot;]{
        +std::vector&amp;lt;std::string&gt; find(std::function predicate)
        -std::unordermap&amp;lt;std::string, Document&gt; data
    }

    class DocumentA{
        +validate() bool
        -id_ : std::string
        -validator : std::function
        -dict : Dictionary
    }

    class DocumentB{
        +validate() bool
        -id_ : std::string
        -validator : std::function
        -dict : Dictionary
    }

    class DocumentC{
        +validate() bool
        -id_ : std::string
        -validator : std::function
        -dict : Dictionary
    }

    class DocumentD{
        +validate() bool
        -id_ : std::string
        -validator : std::function
        -dict : Dictionary
    }

    class DocumentE[&quot;...&quot;]{
        +validate() bool
        -id_ : std::string
        -validator : std::function
        -dict : Dictionary
    }

    class DocumentF[&quot;...&quot;]{
        +validate() bool
        -id_ : std::string
        -validator : std::function
        -dict : Dictionary
    }


    Database &lt;-- CollectionA
    Database &lt;-- CollectionB
    Database &lt;-- CollectionC

    CollectionA &lt;-- DocumentA
    CollectionA &lt;-- DocumentB
    CollectionA &lt;-- DocumentE
    CollectionB &lt;-- DocumentC
    CollectionB &lt;-- DocumentD
    CollectionB &lt;-- DocumentF
    </pre><p>A database can have 0 to N collections and each collection can have 0 to N documents.
At the lowest level is the <code class="docutils literal notranslate"><span class="pre">Document</span></code> class, which is a Dictionary with an ID and a validator function to ensure data integrity.
The Document container is similar to a python dictionary using key-value pairs and can be used to store any type of data.
The following code snippet shows how to create a document and access its values:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Document</span><span class="w"> </span><span class="n">doc</span><span class="p">({{</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;value1&quot;</span><span class="p">)},</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;key2&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">}});</span>
<span class="w">    </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">keys</span><span class="p">().</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="w">    </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">id</span><span class="p">().</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;doc_&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">2.0</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">NeoFOAM::Document</span></code> mainly extends the <code class="docutils literal notranslate"><span class="pre">Dictionary</span></code> class and offers the possibility to validate the data stored in the document.
The following code snippet shows how to create a document with a custom validator function:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="k">const</span><span class="w"> </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Dictionary</span><span class="o">&amp;</span><span class="w"> </span><span class="n">dict</span><span class="p">)</span>
<span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">dict</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dict</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>

<span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Document</span><span class="w"> </span><span class="n">doc</span><span class="p">({{</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;value1&quot;</span><span class="p">)},</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;key2&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">}},</span><span class="w"> </span><span class="n">validator</span><span class="p">);</span>
<span class="n">REQUIRE_NOTHROW</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">validate</span><span class="p">());</span>
</pre></div>
</div>
<p>As stated earlier, the Documents are stored as part of a Collection which itself is stored in the central database as shown in the class diagram above.
To enable custom functionalities the developer can create a custom collection that provides additional functionality to the document.
This is done in the FieldCollection class that is used to store the field data in the database.</p>
<section id="fieldcollection">
<h2>FieldCollection<a class="headerlink" href="#fieldcollection" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">FieldCollection</span></code> stores all fields and provides additional functionality which is stored in a document.
The <code class="docutils literal notranslate"><span class="pre">FieldDocument</span></code> keeps a reference to field as a <code class="docutils literal notranslate"><span class="pre">std::any</span></code> and stores additional metadata like the time index, iteration index, and subcycle index.
The following code snippet shows how to create a <code class="docutils literal notranslate"><span class="pre">FieldDocument</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">FieldType</span><span class="o">&gt;</span>
<span class="n">FieldDocument</span><span class="p">(</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FieldType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">field</span><span class="p">,</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">timeIndex</span><span class="p">,</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">iterationIndex</span><span class="p">,</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kt">int64_t</span><span class="w"> </span><span class="n">subCycleIndex</span>
<span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">doc_</span><span class="p">(</span>
<span class="w">          </span><span class="n">Document</span><span class="p">(</span>
<span class="w">              </span><span class="p">{{</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">field</span><span class="p">.</span><span class="n">name</span><span class="p">},</span>
<span class="w">               </span><span class="p">{</span><span class="s">&quot;timeIndex&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">timeIndex</span><span class="p">},</span>
<span class="w">               </span><span class="p">{</span><span class="s">&quot;iterationIndex&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">iterationIndex</span><span class="p">},</span>
<span class="w">               </span><span class="p">{</span><span class="s">&quot;subCycleIndex&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">subCycleIndex</span><span class="p">},</span>
<span class="w">               </span><span class="p">{</span><span class="s">&quot;field&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">field</span><span class="p">}}</span>
<span class="w">          </span><span class="p">),</span>
<span class="w">          </span><span class="n">validateFieldDoc</span>
<span class="w">      </span><span class="p">)</span>
<span class="p">{}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">FieldDocument</span></code> stores its data in a <code class="docutils literal notranslate"><span class="pre">Document</span></code> and provide the appropriate getters and setters for the data.
The user will most likely not directly create FieldDocument but use the <code class="docutils literal notranslate"><span class="pre">FieldCollection</span></code> to register Field.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">fvcc</span><span class="o">::</span><span class="n">FieldCollection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fieldCollection</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">fvcc</span><span class="o">::</span><span class="n">FieldCollection</span><span class="o">::</span><span class="n">instance</span><span class="p">(</span><span class="n">db</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;newTestFieldCollection&quot;</span><span class="p">);</span>

<span class="n">fvcc</span><span class="o">::</span><span class="n">VolumeField</span><span class="o">&lt;</span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">scalar</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">fieldCollection</span><span class="p">.</span><span class="n">registerField</span><span class="o">&lt;</span><span class="n">fvcc</span><span class="o">::</span><span class="n">VolumeField</span><span class="o">&lt;</span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">scalar</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">CreateField</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;T&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">mesh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">timeIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">iterationIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">subCycleIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">FieldCollection</span></code> has a static instance methods that returns the instance of the <code class="docutils literal notranslate"><span class="pre">FieldCollection</span></code> or creates a new one if it doesn’t exist.
registerField method is used to register fields and expects a CreateFunction that returns a FieldDocument and expects a database as an argument.
The createFunction could look as followed:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">CreateField</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">UnstructuredMesh</span><span class="w"> </span><span class="n">mesh</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">timeIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">iterationIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kt">int64_t</span><span class="w"> </span><span class="n">subCycleIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Document</span><span class="w"> </span><span class="nf">operator</span><span class="p">()(</span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Database</span><span class="o">&amp;</span><span class="w"> </span><span class="n">db</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">fvcc</span><span class="o">::</span><span class="n">VolumeBoundary</span><span class="o">&lt;</span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">scalar</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bcs</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">patchi</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">})</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Dictionary</span><span class="w"> </span><span class="n">dict</span><span class="p">;</span>
<span class="w">            </span><span class="n">dict</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;fixedValue&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="n">dict</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;fixedValue&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">);</span>
<span class="w">            </span><span class="n">bcs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">fvcc</span><span class="o">::</span><span class="n">VolumeBoundary</span><span class="o">&lt;</span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">scalar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">,</span><span class="w"> </span><span class="n">patchi</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Field</span><span class="w"> </span><span class="n">internalField</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Field</span><span class="o">&lt;</span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">scalar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mesh</span><span class="p">.</span><span class="n">exec</span><span class="p">(),</span><span class="w"> </span><span class="n">mesh</span><span class="p">.</span><span class="n">nCells</span><span class="p">(),</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">        </span><span class="n">fvcc</span><span class="o">::</span><span class="n">VolumeField</span><span class="o">&lt;</span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">scalar</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vf</span><span class="p">(</span>
<span class="w">            </span><span class="n">mesh</span><span class="p">.</span><span class="n">exec</span><span class="p">(),</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="n">internalField</span><span class="p">,</span><span class="w"> </span><span class="n">bcs</span><span class="p">,</span><span class="w"> </span><span class="n">db</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Document</span><span class="p">(</span>
<span class="w">            </span><span class="p">{{</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vf</span><span class="p">.</span><span class="n">name</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;timeIndex&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">timeIndex</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;iterationIndex&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">iterationIndex</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;subCycleIndex&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">subCycleIndex</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;field&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vf</span><span class="p">}},</span>
<span class="w">            </span><span class="n">fvcc</span><span class="o">::</span><span class="n">validateFieldDoc</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This design can be easily extended to create and read fields.
The <code class="docutils literal notranslate"><span class="pre">FieldCollection</span></code> allows us to access and find fields by their name, time index, iteration index, or subcycle index.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">fvcc</span><span class="o">::</span><span class="n">FieldCollection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fieldCollection</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">fvcc</span><span class="o">::</span><span class="n">FieldCollection</span><span class="o">::</span><span class="n">instance</span><span class="p">(</span><span class="n">db</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;newTestFieldCollection&quot;</span><span class="p">);</span>

<span class="k">auto</span><span class="w"> </span><span class="n">resName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fieldCollection</span><span class="p">.</span><span class="n">find</span><span class="p">([](</span><span class="k">const</span><span class="w"> </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Document</span><span class="o">&amp;</span><span class="w"> </span><span class="n">doc</span><span class="p">)</span>
<span class="w">                                </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;T&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>

<span class="n">REQUIRE</span><span class="p">(</span><span class="n">resName</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fieldDoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fieldCollection</span><span class="p">.</span><span class="n">fieldDoc</span><span class="p">(</span><span class="n">resName</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">constVolField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fieldDoc</span><span class="p">.</span><span class="n">field</span><span class="o">&lt;</span><span class="n">fvcc</span><span class="o">::</span><span class="n">VolumeField</span><span class="o">&lt;</span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">scalar</span><span class="o">&gt;&gt;</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="query-of-document-in-a-collection">
<h2>Query of document in a collection<a class="headerlink" href="#query-of-document-in-a-collection" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Collection</span></code> class provides a find method that allows the user to query the documents in the collection.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fieldCollection</span><span class="p">.</span><span class="n">find</span><span class="p">(</span>
<span class="w">    </span><span class="p">[](</span><span class="k">const</span><span class="w"> </span><span class="n">Document</span><span class="o">&amp;</span><span class="w"> </span><span class="n">doc</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;someName&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;someValue&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">42.0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The developer can provide a lambda function that returns a boolean value to filter the documents in the collection.
The find function returns a vector of keys that match the query.</p>
</section>
<section id="adding-a-new-collection-and-documents-to-the-database">
<h2>Adding a new collection and documents to the database<a class="headerlink" href="#adding-a-new-collection-and-documents-to-the-database" title="Link to this heading">¶</a></h2>
<p>The database supports extensibility through a type-erased interface for collections.
This design allows developers to create and manage collections of custom documents with minimal coupling.
A collection provides access to its stored documents, and the only requirement for custom documents is that they extend the base Document class and implement the necessary functionality.</p>
<section id="creating-a-custom-document">
<h3>Creating a Custom Document<a class="headerlink" href="#creating-a-custom-document" title="Link to this heading">¶</a></h3>
<p>Custom documents extend the Document class and add domain-specific functionality. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CustomDocument</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>

<span class="w">    </span><span class="n">CustomDocument</span><span class="p">(</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="o">&amp;</span><span class="w"> </span><span class="n">testValue</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">doc_</span><span class="p">(</span>
<span class="w">            </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Document</span><span class="p">(</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span><span class="s">&quot;testValue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">testValue</span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="p">,</span><span class="w"> </span><span class="n">validateCustomDoc</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">doc_</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">doc_</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">testValue</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">doc_</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;testValue&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kt">double</span><span class="o">&amp;</span><span class="w"> </span><span class="n">testValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">doc_</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;testValue&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>


<span class="w">    </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Document</span><span class="o">&amp;</span><span class="w"> </span><span class="n">doc</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">doc_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Document</span><span class="o">&amp;</span><span class="w"> </span><span class="n">doc</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">doc_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">id</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">doc_</span><span class="p">.</span><span class="n">id</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">typeName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;CustomDocument&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="k">private</span><span class="o">:</span>

<span class="w">    </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Document</span><span class="w"> </span><span class="n">doc_</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Here, the CustomDocument class:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Wraps the base Document with its own fields (name and testValue) and validates it.</p></li>
<li><p>Provides accessor functions for these variables</p></li>
</ol>
</div></blockquote>
<p>The Document class can be easily wrapped with a custom class to provide additional functionality as shown below.</p>
</section>
<section id="storing-custom-documents-in-a-custom-collection">
<h3>Storing Custom Documents in a Custom Collection<a class="headerlink" href="#storing-custom-documents-in-a-custom-collection" title="Link to this heading">¶</a></h3>
<p>Collections manage a set of user-defined documents and provide operations to query and modify them.
The CollectionMixin template simplifies creating custom collections for user-defined documents. For instance:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CustomCollection</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">CollectionMixin</span><span class="o">&lt;</span><span class="n">CustomDocument</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>

<span class="w">    </span><span class="n">CustomCollection</span><span class="p">(</span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Database</span><span class="o">&amp;</span><span class="w"> </span><span class="n">db</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">CollectionMixin</span><span class="o">&lt;</span><span class="n">CustomDocument</span><span class="o">&gt;</span><span class="p">(</span><span class="n">db</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>

<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">docs_</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">insert</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">CustomDocument</span><span class="o">&amp;</span><span class="w"> </span><span class="n">cc</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cc</span><span class="p">.</span><span class="n">id</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">contains</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">docs_</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">cc</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">CustomCollection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">instance</span><span class="p">(</span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Database</span><span class="o">&amp;</span><span class="w"> </span><span class="n">db</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">NeoFOAM</span><span class="o">::</span><span class="n">Collection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">CustomCollection</span><span class="p">(</span><span class="n">db</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">col</span><span class="p">.</span><span class="n">as</span><span class="o">&lt;</span><span class="n">CustomCollection</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In this example:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>CustomCollection inherits from CollectionMixin&lt;CustomDocument&gt;, which already provides the necessary functionality for managing custom documents.</p></li>
<li><p>instance is a static method that returns the instance of the CustomCollection or creates a new one if it doesn’t exist.</p></li>
</ol>
</div></blockquote>
<p>This design allows developers to create custom collections with minimal boilerplate code and focus on the domain-specific functionality of the documents.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../mpi_architecture.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">MPI Architecture</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="dictionary.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Dictionary</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, NeoFOAM authors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Database</a><ul>
<li><a class="reference internal" href="#fieldcollection">FieldCollection</a></li>
<li><a class="reference internal" href="#query-of-document-in-a-collection">Query of document in a collection</a></li>
<li><a class="reference internal" href="#adding-a-new-collection-and-documents-to-the-database">Adding a new collection and documents to the database</a><ul>
<li><a class="reference internal" href="#creating-a-custom-document">Creating a Custom Document</a></li>
<li><a class="reference internal" href="#storing-custom-documents-in-a-custom-collection">Storing Custom Documents in a Custom Collection</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    </body>
</html>